<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Distributed programming in Rama :: Red Planet Labs Documentation</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
<!-- Google tag (gtag.js) -->
<script async="" src="//cse.google.com/adsense/search/async-ads.js"></script><script type="text/javascript" async="" src="https://www.googletagmanager.com/gtag/js?id=G-6FCG0W0TYJ&amp;l=dataLayer&amp;cx=c&amp;gtm=457e53h1za200&amp;tag_exp=102482433~102587591~102717422~102788824~102813109~102814060~102825837~102879719"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-137231341-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-6FCG0W0TYJ');
</script>
  <script src="https://www.google.com/cse/static/element/75c56d121cde450a/cse_element__en.js?usqp=CAM%3D" type="text/javascript"></script><link type="text/css" href="https://www.google.com/cse/static/element/75c56d121cde450a/default+en.css" rel="stylesheet"><link type="text/css" href="https://www.google.com/cse/static/style/look/v4/default.css" rel="stylesheet"><style type="text/css">.gsc-control-cse{font-family:arial, sans-serif}.gsc-control-cse .gsc-table-result{font-family:arial, sans-serif}.gsc-refinementsGradient{background:linear-gradient(to left,rgba(255,255,255,1),rgba(255,255,255,0))}.gsc-control-cse{border-color:#1a1a1a;background-color:#1a1a1a}input.gsc-input,.gsc-input-box,.gsc-input-box-hover,.gsc-input-box-focus{border-color:#DFE1E5}.gsc-search-button-v2,.gsc-search-button-v2:hover,.gsc-search-button-v2:focus{border-color:#3079ED;background-color:#4D90FE;background-image:none;filter:none}.gsc-search-button-v2 svg{fill:#FFFFFF}.gsc-tabHeader.gsc-tabhActive,.gsc-refinementHeader.gsc-refinementhActive{color:#1A73E8;border-color:#1A73E8;background-color:#FFFFFF}.gsc-tabHeader.gsc-tabhInactive,.gsc-refinementHeader.gsc-refinementhInactive{color:#666666;border-color:#666666;background-color:#FFFFFF}.gsc-webResult.gsc-result,.gsc-results .gsc-imageResult{border-color:#FFFFFF;background-color:#FFFFFF}.gsc-webResult.gsc-result:hover{border-color:#FFFFFF;background-color:#FFFFFF}.gs-webResult.gs-result a.gs-title:link,.gs-webResult.gs-result a.gs-title:link b,.gs-imageResult a.gs-title:link,.gs-imageResult a.gs-title:link b{color:#1155CC}.gs-webResult.gs-result a.gs-title:visited,.gs-webResult.gs-result a.gs-title:visited b,.gs-imageResult a.gs-title:visited,.gs-imageResult a.gs-title:visited b{color:#1155CC}.gs-webResult.gs-result a.gs-title:hover,.gs-webResult.gs-result a.gs-title:hover b,.gs-imageResult a.gs-title:hover,.gs-imageResult a.gs-title:hover b{color:#1155CC}.gs-webResult.gs-result a.gs-title:active,.gs-webResult.gs-result a.gs-title:active b,.gs-imageResult a.gs-title:active,.gs-imageResult a.gs-title:active b{color:#1155CC}.gsc-cursor-page{color:#1155CC}a.gsc-trailing-more-results:link{color:#1155CC}.gs-webResult:not(.gs-no-results-result):not(.gs-error-result) .gs-snippet,.gs-fileFormatType{color:#333333}.gs-webResult div.gs-visibleUrl{color:#009933}.gs-webResult div.gs-visibleUrl-short{color:#009933}.gs-webResult div.gs-visibleUrl-short{display:none}.gs-webResult div.gs-visibleUrl-long{display:none}.gs-webResult div.gs-visibleUrl-breadcrumb{display:block}.gs-promotion div.gs-visibleUrl-short{display:none}.gs-promotion div.gs-visibleUrl-long{display:block}.gs-promotion div.gs-visibleUrl-breadcrumb{display:none}.gsc-cursor-box{border-color:#FFFFFF}.gsc-results .gsc-cursor-box .gsc-cursor-page{border-color:#666666;background-color:#FFFFFF;color:#666666}.gsc-results .gsc-cursor-box .gsc-cursor-current-page{border-color:#1A73E8;background-color:#FFFFFF;color:#1A73E8}.gsc-webResult.gsc-result.gsc-promotion{border-color:#FFFFFF;background-color:#F6F6F6}.gsc-completion-title{color:#1155CC}.gsc-completion-snippet{color:#333333}.gs-promotion a.gs-title:link,.gs-promotion a.gs-title:link *,.gs-promotion .gs-snippet a:link{color:#1155CC}.gs-promotion a.gs-title:visited,.gs-promotion a.gs-title:visited *,.gs-promotion .gs-snippet a:visited{color:#1155CC}.gs-promotion a.gs-title:hover,.gs-promotion a.gs-title:hover *,.gs-promotion .gs-snippet a:hover{color:#1155CC}.gs-promotion a.gs-title:active,.gs-promotion a.gs-title:active *,.gs-promotion .gs-snippet a:active{color:#1155CC}.gs-promotion .gs-snippet,.gs-promotion .gs-title .gs-promotion-title-right,.gs-promotion .gs-title .gs-promotion-title-right *{color:#333333}.gs-promotion .gs-visibleUrl,.gs-promotion .gs-visibleUrl-short{color:#009933}.gcsc-find-more-on-google{color:#1155CC}.gcsc-find-more-on-google-magnifier{fill:#1155CC}</style><style type="text/css">.gscb_a{display:inline-block;font:27px/13px arial,sans-serif}.gsst_a .gscb_a{color:#a1b9ed;cursor:pointer}.gsst_a:hover .gscb_a,.gsst_a:focus .gscb_a{color:#36c}.gsst_a{display:inline-block}.gsst_a{cursor:pointer;padding:0 4px}.gsst_a:hover{text-decoration:none!important}.gsst_b{font-size:16px;padding:0 2px;position:relative;user-select:none;-webkit-user-select:none;white-space:nowrap}.gsst_e{vertical-align:middle;opacity:0.55;}.gsst_a:hover .gsst_e,.gsst_a:focus .gsst_e{opacity:0.72;}.gsst_a:active .gsst_e{opacity:1;}.gsst_f{background:white;text-align:left}.gsst_g{background-color:white;border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-webkit-box-shadow:0 2px 4px rgba(0,0,0,0.2);margin:-1px -3px;padding:0 6px}.gsst_h{background-color:white;height:1px;margin-bottom:-1px;position:relative;top:-1px}.gsib_a{width:100%;padding:4px 6px 0}.gsib_a,.gsib_b{vertical-align:top}.gssb_c{border:0;position:absolute;z-index:989}.gssb_e{border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-webkit-box-shadow:0 2px 4px rgba(0,0,0,0.2);cursor:default}.gssb_f{visibility:hidden;white-space:nowrap}.gssb_k{border:0;display:block;position:absolute;top:0;z-index:988}.gsdd_a{border:none!important}.gsq_a{padding:0}.gssb_a{padding:0 7px}.gssb_a,.gssb_a td{white-space:nowrap;overflow:hidden;line-height:22px}#gssb_b{font-size:11px;color:#36c;text-decoration:none}#gssb_b:hover{font-size:11px;color:#36c;text-decoration:underline}.gssb_g{text-align:center;padding:8px 0 7px;position:relative}.gssb_h{font-size:15px;height:28px;margin:0.2em;-webkit-appearance:button}.gssb_i{background:#eee}.gss_ifl{visibility:hidden;padding-left:5px}.gssb_i .gss_ifl{visibility:visible}a.gssb_j{font-size:13px;color:#36c;text-decoration:none;line-height:100%}a.gssb_j:hover{text-decoration:underline}.gssb_l{height:1px;background-color:#e5e5e5}.gssb_m{color:#000;background:#fff}.gssb_a{padding:0 9px}.gsib_a{padding:5px 9px 4px 9px}.gscb_a{line-height:27px}.gssb_e{border:0}.gssb_l{margin:5px 0}input.gsc-input::-webkit-input-placeholder{font-size:14px}input.gsc-input:-moz-placeholder{font-size:14px}input.gsc-input::-moz-placeholder{font-size:14px}input.gsc-input:-ms-input-placeholder{font-size:14px}input.gsc-input:focus::-webkit-input-placeholder{color:transparent}input.gsc-input:focus:-moz-placeholder{color:transparent}input.gsc-input:focus::-moz-placeholder{color:transparent}input.gsc-input:focus:-ms-input-placeholder{color:transparent}.gssb_c .gsc-completion-container{position:static}.gssb_c{z-index:5000}.gsc-completion-container table{background:transparent;font-size:inherit;font-family:inherit}.gssb_c > tbody > tr,.gssb_c > tbody > tr > td,.gssb_d,.gssb_d > tbody > tr,.gssb_d > tbody > tr > td,.gssb_e,.gssb_e > tbody > tr,.gssb_e > tbody > tr > td{padding:0;margin:0;border:0}.gssb_a table,.gssb_a table tr,.gssb_a table tr td{padding:0;margin:0;border:0}</style></head>
  <body class="article">
<style>
  p {
    hyphens: none;
  }
  td {
    hyphens: none;
  }

  p code {
    background: #eeeeee !important
  }

  .gsc-clear-button {
    display: none;
  }

  .gsc-control-cse {
    font-size: 10px !important
  }
</style>
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/~/index.html">Red Planet Labs Documentation</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <script async="" src="https://cse.google.com/cse.js?cx=a198d0f9938004cd4">
          </script>
          <div id="___gcse_0"><div class="gsc-control-cse gsc-control-cse-en"><div class="gsc-control-wrapper-cse" dir="ltr"><form class="gsc-search-box gsc-search-box-tools" accept-charset="utf-8"><table cellspacing="0" cellpadding="0" role="presentation" class="gsc-search-box"><tbody><tr><td class="gsc-input"><div class="gsc-input-box" id="gsc-iw-id1"><table cellspacing="0" cellpadding="0" role="presentation" id="gs_id50" class="gstl_50 gsc-input" style="width: 100%; padding: 0px;"><tbody><tr><td id="gs_tti50" class="gsib_a"><input autocomplete="off" type="text" size="10" class="gsc-input" name="search" title="search" aria-label="search" id="gsc-i-id1" dir="ltr" spellcheck="false" style="width: 100%; padding: 0px; border: none; margin: 0px; height: auto; outline: none;"></td><td class="gsib_b"><div class="gsst_b" id="gs_st50" dir="ltr"><a class="gsst_a" href="javascript:void(0)" title="Clear search box" role="button" style="display: none;"><span class="gscb_a" id="gs_cb50" aria-hidden="true">Ã—</span></a></div></td></tr></tbody></table></div></td><td class="gsc-search-button"><button class="gsc-search-button gsc-search-button-v2"><svg width="13" height="13" viewBox="0 0 13 13"><title>search</title><path d="m4.8495 7.8226c0.82666 0 1.5262-0.29146 2.0985-0.87438 0.57232-0.58292 0.86378-1.2877 0.87438-2.1144 0.010599-0.82666-0.28086-1.5262-0.87438-2.0985-0.59352-0.57232-1.293-0.86378-2.0985-0.87438-0.8055-0.010599-1.5103 0.28086-2.1144 0.87438-0.60414 0.59352-0.8956 1.293-0.87438 2.0985 0.021197 0.8055 0.31266 1.5103 0.87438 2.1144 0.56172 0.60414 1.2665 0.8956 2.1144 0.87438zm4.4695 0.2115 3.681 3.6819-1.259 1.284-3.6817-3.7 0.0019784-0.69479-0.090043-0.098846c-0.87973 0.76087-1.92 1.1413-3.1207 1.1413-1.3553 0-2.5025-0.46363-3.4417-1.3909s-1.4088-2.0686-1.4088-3.4239c0-1.3553 0.4696-2.4966 1.4088-3.4239 0.9392-0.92727 2.0864-1.3969 3.4417-1.4088 1.3553-0.011889 2.4906 0.45771 3.406 1.4088 0.9154 0.95107 1.379 2.0924 1.3909 3.4239 0 1.2126-0.38043 2.2588-1.1413 3.1385l0.098834 0.090049z"></path></svg></button></td><td class="gsc-clear-button"><div class="gsc-clear-button" title="clear results">&nbsp;</div></td></tr></tbody></table></form><div class="gsc-results-wrapper-overlay"><div class="gsc-results-close-btn" tabindex="0"></div><div class="gsc-positioningWrapper"><div class="gsc-tabsAreaInvisible"><div aria-label="refinement" role="tab" class="gsc-tabHeader gsc-inline-block gsc-tabhActive">Custom Search</div><span class="gs-spacer"> </span></div></div><div class="gsc-positioningWrapper"><div class="gsc-refinementsAreaInvisible"></div></div><div class="gsc-above-wrapper-area-invisible"><div class="gsc-above-wrapper-area-backfill-container"></div><table cellspacing="0" cellpadding="0" role="presentation" class="gsc-above-wrapper-area-container"><tbody><tr><td class="gsc-result-info-container"><div class="gsc-result-info-invisible"></div></td><td class="gsc-orderby-container"><div class="gsc-orderby-invisible"><div class="gsc-orderby-label gsc-inline-block">Sort by:</div><div class="gsc-option-menu-container gsc-inline-block"><div class="gsc-selected-option-container gsc-inline-block"><div class="gsc-selected-option">Relevance</div><div class="gsc-option-selector"></div></div><div class="gsc-option-menu-invisible"><div class="gsc-option-menu-item gsc-option-menu-item-highlighted"><div class="gsc-option">Relevance</div></div><div class="gsc-option-menu-item"><div class="gsc-option">Date</div></div></div></div></div></td></tr></tbody></table></div><div class="gsc-adBlockInvisible"></div><div class="gsc-wrapper"><div class="gsc-adBlockInvisible"></div><div class="gsc-resultsbox-invisible"><div class="gsc-resultsRoot gsc-tabData gsc-tabdActive"><div><div class="gsc-expansionArea"></div></div></div></div></div></div><div class="gsc-modal-background-image" tabindex="0"></div></div></div></div>
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="~">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style=""></button>
    <h3 class="title"><a href="index.html">Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item is-active is-current-path" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="why-use-rama.html">Why use Rama?</a>
  </li>
  <li class="nav-item is-active is-current-path" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="tutorial1.html">Tutorial</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tutorial1.html">First module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tutorial2.html">Depots, ETLs, and PStates</a>
  </li>
  <li class="nav-item is-current-page is-active" data-depth="2">
    <a class="nav-link" href="tutorial3.html">Distributed programming</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tutorial4.html">Dataflow programming</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tutorial5.html">Types of ETLs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tutorial6.html">Tying it all together</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="downloads-maven-local-dev.html">Downloads, Maven, and local development</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="terminology.html">Terminology</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="paths.html">Paths</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="intermediate-dataflow.html">Intermediate dataflow programming</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="aggregators.html">Aggregators</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="stream.html">Stream topologies</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="microbatch.html">Microbatch topologies</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="query.html">Query topologies</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="depots.html">Depots</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pstates.html">PStates</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="partitioners.html">Partitioners</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serialization.html">Custom serialization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="module-dependencies.html">Dependencies between modules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="operating-rama.html">Operating Rama clusters</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="heterogenous-clusters.html">Heterogenous clusters</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="replication.html">Replication</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="backups.html">Backups</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="acid.html">ACID semantics</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="rest.html">REST API</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="integrating.html">Integrating with other tools</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="all-configs.html">All configs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="testing.html">Testing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="clj-defining-modules.html">Clojure API</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="clj-defining-modules.html">Defining and using modules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="clj-dataflow-lang.html">Dataflow language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="clj-serialization.html">Custom serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="clj-testing.html">Testing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Documentation</span>
    <span class="version">~</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="index.html">Documentation</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">~</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Documentation</a></li>
    <li><a href="tutorial1.html">Tutorial</a></li>
    <li><a href="tutorial3.html">Distributed programming</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"><h3>Contents</h3><ul><li data-level="1"><a href="#_why_distributed" class="">Why distributed?</a></li><li data-level="1"><a href="#task-model" class="">Designed for performance: the task model</a></li><li data-level="1"><a href="#_pstates_and_depots_are_partitioned_across_tasks" class="">PStates and depots are partitioned across tasks</a></li><li data-level="1"><a href="#_partitioning_the_verb" class="is-active">Partitioning, the verb</a></li><li data-level="1"><a href="#_designing_applications_for_tasks">Designing applications for tasks</a></li><li data-level="2"><a href="#_performance">Performance</a></li><li data-level="2"><a href="#_consistency">Consistency</a></li><li data-level="1"><a href="#_summary">Summary</a></li></ul></div>
</aside>
<article class="doc">
<h1 class="page">Distributed programming in Rama</h1>
<aside class="toc embedded"><div class="toc-menu"><h3>Contents</h3><ul><li data-level="1"><a href="#_why_distributed">Why distributed?</a></li><li data-level="1"><a href="#task-model">Designed for performance: the task model</a></li><li data-level="1"><a href="#_pstates_and_depots_are_partitioned_across_tasks">PStates and depots are partitioned across tasks</a></li><li data-level="1"><a href="#_partitioning_the_verb">Partitioning, the verb</a></li><li data-level="1"><a href="#_designing_applications_for_tasks">Designing applications for tasks</a></li><li data-level="2"><a href="#_performance">Performance</a></li><li data-level="2"><a href="#_consistency">Consistency</a></li><li data-level="1"><a href="#_summary">Summary</a></li></ul></div></aside><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Now that you have a basic understanding of how to do work in Rama, letâ€™s explore Ramaâ€™s model for <em>distributing</em> that work. This page will teach you:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ramaâ€™s distributed programming model</p>
</li>
<li>
<p>The mechanics of working with that model</p>
</li>
<li>
<p>The modelâ€™s implications for you, the developer, as you design your application</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Distributed programming</em> is the practice of coordinating work and resources so
that work can be performed by <em>distributed systems</em>â€‰â€”â€‰networked machines which
communicate by message passing. Itâ€™s a deep topic, and this tutorial isnâ€™t meant
to get you to a point of deep expertise with it.</p>
</div>
<div class="paragraph">
<p>Indeed â€“ part of the point of Rama is that you donâ€™t <em>need</em> deep expertise to be
productive. Instead, weâ€™ll cover enough theory and concepts so that youâ€™ll be
able to reason about whatâ€™s going on in your cluster, and weâ€™ll spend most of
the time focusing on how to use Ramaâ€™s tools and abstractions to build working
applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_distributed"><a class="anchor" href="#_why_distributed"></a>Why distributed?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On the conceptual end, letâ€™s start by discussing <em>why</em> youâ€™d want to build a
distributed system; this will help us understand the rationale underlying Ramaâ€™s
design.</p>
</div>
<div class="paragraph">
<p>There are three main reasons you might want to develop a distributed system:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Separation of concerns.</strong> You simply need to communicate with other systems
that have their own, separate purpose. Indeed, much of modern development
involves working with distributed systems in some fashion in that at the very
least youâ€™re dealing with client/server interactions with a database.</p>
</li>
<li>
<p><strong>Performance.</strong> You want your application to handle more load, and to do that
it needs to be deployed to more machines. Your application should be able to scale to more load
in the future by adding machines.</p>
</li>
<li>
<p><strong>Resilience.</strong> You want your application to be resilient to failure, allowing
it to stay up longer. This usually involves creating clusters where a
<em>leader</em> <a href="replication.html" class="page">replicates</a> its state to <em>followers</em> that can take over if the leader
fails for some reason.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>While Ramaâ€™s design addresses each of these needs, right
now weâ€™re only going to focus on the aspects of the design that support
<em>performance</em>. Specifically, weâ€™re
going to look at how Ramaâ€™s design makes it trivial to distribute work across
multiple machines, and weâ€™re going to look at the constructs that Rama provides
to leverage this capability.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="task-model"><a class="anchor" href="#task-model"></a>Designed for performance: the task model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a Rama module you define all the storage and implement all the logic needed for your backend. Modules can have any number of depots, topologies, and PStates. When you deploy a module to a Rama cluster, you specify how much parallelism it should have, which consists of three main parameters:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Tasks</p>
</li>
<li>
<p>Threads</p>
</li>
<li>
<p>Workers</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A "task" is a partition of a module. A module with four tasks could look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/module-structure.png" alt="module structure">
</div>
</div>
<div class="paragraph">
<p>A task contains one partition of every depot and PState for the module as well as an event queue for running events on that task. A running event has access to all depot and PState partitions on that task. Coding a topology involves reading and writing to PStates, running business logic, and switching between tasks as necessary. The number of tasks must be a power of two.</p>
</div>
<div class="paragraph">
<p>Tasks are like <a href="https://en.wikipedia.org/wiki/Green_thread">green threads</a>. You specify the mapping of tasks to actual threads and processes with the "threads" and "workers" parameters. If you specify a module should have 64 tasks, 32 threads, and 8 workers, then each thread will run two tasks. 8 JVM processes called "workers" will be spawned around the cluster each with 4 threads. You scale a module up or down by changing the number of threads and workers.</p>
</div>
<div class="paragraph">
<p>Ramaâ€™s dataflow API, which youâ€™ve gotten a small taste of so far, makes is seamless to jump around the cluster between tasks to query and manipulate different partitions of different PStates.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The term "task" is overloaded in the world of programming. In talking about a
Rama program, you might say something like "That module has eight tasks", meaning
there are eight copies of the module concurrently running; or you might say
"there are eight tasks running this module" to mean essentially the same thing.
Tasks are identified by index, starting with zero; if you launch a module with
eight tasks you would refer to tasks zero through seven and say things like "It
seems like task zero is seeing significantly more load".</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Hereâ€™s a recap of how modules work:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When you define a module, you define the moduleâ€™s depots, ETLs, and PStates.</p>
</li>
<li>
<p>To run a module, you launch it on a cluster.</p>
</li>
<li>
<p>At runtime, records are appended to depots.</p>
</li>
<li>
<p>ETLs read depot records and perform a sequence of actions for each record.</p>
</li>
<li>
<p>That sequence of actions includes updating PStates.</p>
</li>
<li>
<p>Queries read and transform PState data.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Up to this point this description of modules has been presented as if a module runs
on only a single taskâ€‰â€”â€‰as if depot and PState data is stored in a single place
and ETLs are executed on a single thread. Letâ€™s consider what it means for a
module to run on two tasks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pstates_and_depots_are_partitioned_across_tasks"><a class="anchor" href="#_pstates_and_depots_are_partitioned_across_tasks"></a>PStates and depots are partitioned across tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, as mentioned PStates and depots are <em>partitioned</em> across tasks. To partition a data
store is to map a <em>logical</em> entity to multiple, separate <em>physical</em> locations,
called <em>partitions</em>.</p>
</div>
<div class="paragraph">
<p>For example, consider a module launched with two tasks that has a
<code>"$$wordCounts"</code> PState. At the logical level, you think about the
<code>"$$wordCounts"</code> PState in terms of its schema and its purpose within its
module (storing word counts). At the physical level, the PState is divided into
two partitions, one per task, and when a task executes an ETL it uses the
identifier <code>"$$wordCounts"</code> to refer to the <em>partition</em> for <code>"$$wordCounts"</code>
which belongs to that task.</p>
</div>
<div class="paragraph">
<p>This has huge implications: If you launch a module and an ETL on task 0
increments the count for the word <code>"ostentation"</code>, and an ETL on task 1 does the
same, then each of the partitions for <code>"$$wordCounts"</code> will contain the entry
<code>{"ostentation": 1}</code>, even though the word has been counted two times globally.</p>
</div>
<div class="paragraph">
<p>Itâ€™s very unlikely you want this result. Instead, you want the word
<code>"ostentation"</code> to always be handled by the same task because you want its
associated count to only be recorded and updated on a single partition. You want
to be able to control <em>where</em> data is sent and where work is performed. Rama has
tools to let you do this easily, which weâ€™ll look at next.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_partitioning_the_verb"><a class="anchor" href="#_partitioning_the_verb"></a><em>Partitioning</em>, the verb</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You control where work is performed with <em>partitioners</em>. There are two places
you can use partitioners:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a depotâ€™s definition</p>
</li>
<li>
<p>In ETLs</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A depot partitioner defines which task Rama clients send a record to when
they append a record to a depot. ETL partitioners let you relocate an ETL to a
different task.</p>
</div>
<div class="paragraph">
<p>To get a better sense of what this all means, letâ€™s revisit the simple word
count example to see how partitioners are declared and used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">package</span> rama.examples.tutorial;

<span class="hljs-keyword">import</span> com.rpl.rama.*;
<span class="hljs-keyword">import</span> com.rpl.rama.<span class="hljs-keyword">module</span>.*;
<span class="hljs-keyword">import</span> com.rpl.rama.test.*;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleWordCountModule</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RamaModule</span> </span>{
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">define</span><span class="hljs-params">(Setup setup, Topologies topologies)</span> </span>{
    setup.declareDepot(<span class="hljs-string">"*wordDepot"</span>, Depot.random());

    StreamTopology s = topologies.stream(<span class="hljs-string">"wordCountStream"</span>);
    s.pstate(<span class="hljs-string">"$$wordCounts"</span>, PState.mapSchema(String<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">Long</span>.<span class="hljs-title">class</span>))</span>;

    s.source(<span class="hljs-string">"*wordDepot"</span>).out(<span class="hljs-string">"*token"</span>)
     .hashPartition(<span class="hljs-string">"*token"</span>)
     .compoundAgg(<span class="hljs-string">"$$wordCounts"</span>, CompoundAgg.map(<span class="hljs-string">"*token"</span>, Agg.count()));
  }
}</code></pre>
<div class="source-toolbox"><span class="source-lang">java</span><button class="copy-button" title="Copy to clipboard"><img src="../../_/img/octicons-16.svg#view-clippy" alt="copy icon" class="copy-icon"><span class="copy-toast">Copied!</span></button></div></div>
</div>
<div class="paragraph">
<p>This module defines a depot with <code>setup.declareDepot("*wordDepot",
Depot.random());</code>. The first argument, <code>"*wordDepot"</code>, is the
depotâ€™s identifier. The second argument, <code>Depot.random()</code>, is the depotâ€™s
partitioner.</p>
</div>
<div class="paragraph">
<p>In this case, weâ€™re saying we want to use a random partitioner, meaning that
when a Rama client appends a record to this depot, the record will be sent to a
random task and added to that taskâ€™s <code>"*wordDepot"</code> partition.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Random partitioning isnâ€™t the best method to use here because itâ€™s
inefficient; after weâ€™ve covered the mechanics of how partitioners work, weâ€™ll
explore how to make good decisions around partitioning and consider the design
implications that first-class partitioning has for your application.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>So thatâ€™s how depot partitioners work. An example of an ETL partitioner is
<code>.hashPartition("*token")</code>. <code>.hashPartition</code> is the partitioner,
and its purpose is to <em>relocate</em> the rest of the ETL to a different task. To
relocate an ETL is to transfer the current scopeâ€‰â€”â€‰the bindings created by
<code>.out</code>â€‰â€”â€‰to a task, and restore the scope on that task and resume the ETL from
where it left off. In conversation, we also say that the ETL <em>partitions to</em> a
task to mean that the ETL has relocated.</p>
</div>
<div class="paragraph">
<p>Letâ€™s walk through a timeline to better understand how this works:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>depot.append("one")</code> appends the string <code>"one"</code> to a random depot partition.
Letâ€™s assume that this is the depotâ€™s partition 0, or <code>d0</code> for short.</p>
</li>
<li>
<p>Task 0, which owns <code>d0</code>, is running the ETL <code>s</code>. Also, <code>d0</code> is referred to as
<code>"*depot"</code> within task 0. The first step of <code>s</code> is
<code>s.source("*depot").out("*token")</code>, which reads records from <code>"*depot"</code> and
binds them to <code>"*token"</code>.</p>
</li>
<li>
<p>The next step of ETL <code>s</code> is <code>.hashPartition("*token")</code>. It determines which PState partition the input "belongs"
to, then it partitions to the corresponding task. In this case, we have two
tasks so the ETL will partition to either task 0 or task 1, transferring its
scope. Letâ€™s assume it partitions to task 1.</p>
</li>
<li>
<p>The ETL resumes where it left off: the step <code>.compoundAgg("$$wordCounts",
   CompoundAgg.map("*token", Agg.count()))</code> updates the <code>$$wordCounts</code>
partition for task 1, increasing the count that corresponds to the string
<code>"one"</code>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/distributed/word-count.svg" alt="word count">
</div>
</div>
<div class="paragraph">
<p>As the application continues to run, itâ€™s possible for the string <code>"one"</code> to get
appended to <code>"*depot"</code> more times. It will continue getting randomly appended to
either the depot partition on task 0 or on task 1, but the ETL will <em>always</em>
result in the <code>$$wordCounts</code> partition on task 1 getting updated because
<code>hashPartition("*token")</code> will always partition to task 1 when
<code>"*token"</code> is bound to the string <code>"one"</code>.</p>
</div>
<div class="paragraph">
<p>To recap:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Rama modules run on one or more concurrently executing tasks.</p>
</li>
<li>
<p>Tasks are identical in structure and function, but differ in the contents of
their depot and PState partitions.</p>
</li>
<li>
<p>Depot partitioners determine which depot a record gets appended to.</p>
</li>
<li>
<p>ETL partitioners relocate an ETL run to another task.</p>
</li>
<li>
<p>Itâ€™s up to you to design your partitioners so that data and work get routed to
the right task.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This last point is unique to Rama, and has larger implications for how you
design your application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_designing_applications_for_tasks"><a class="anchor" href="#_designing_applications_for_tasks"></a>Designing applications for tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rama brings partitioning to the fore when youâ€™re writing your application. It is a first-class resource management concern that is your responsibility to handle correctly. Rama helps you out by giving you a simple model and simple tools so you only have to worry about the <em>inherent complexity</em> of partitioning, not the <em>incidental complexity</em> that systems can introduce.</p>
</div>
<div class="paragraph">
<p>In dealing with the inherent complexity of partitioning, there are two main considerations to keep in mind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Performance</p>
</li>
<li>
<p>Consistency</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Letâ€™s explore each of these.</p>
</div>
<div class="sect2">
<h3 id="_performance"><a class="anchor" href="#_performance"></a>Performance</h3>
<div class="paragraph">
<p>We touched on performance above when we mentioned that the random partitioner of <code>"*wordDepot"</code> introduces an inefficiency: it sometimes routes an append to a task other than the one containing the partition where weâ€™ll store the wordâ€™s count. This requires an extra network hop to transfer the word to the correct partition.</p>
</div>
<div class="paragraph">
<p>You could rewrite the module as follows to avoid this inefficiency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">package</span> rama.examples.tutorial;

<span class="hljs-keyword">import</span> com.rpl.rama.*;
<span class="hljs-keyword">import</span> com.rpl.rama.<span class="hljs-keyword">module</span>.*;
<span class="hljs-keyword">import</span> com.rpl.rama.test.*;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleWordCountModule</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RamaModule</span> </span>{
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">define</span><span class="hljs-params">(Setup setup, Topologies topologies)</span> </span>{
    setup.declareDepot(<span class="hljs-string">"*wordDepot"</span>, Depot.hashBy(Ops.IDENTITY); <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
    StreamTopology s = topologies.stream(<span class="hljs-string">"wordCountStream"</span>);

    s.pstate(<span class="hljs-string">"$$wordCounts"</span>, PState.mapSchema(Object<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">Object</span>.<span class="hljs-title">class</span>))</span>;
    s.source(<span class="hljs-string">"*wordDepot"</span>).out(<span class="hljs-string">"*token"</span>)
     <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
     .compoundAgg(<span class="hljs-string">"$$wordCounts"</span>, CompoundAgg.map(<span class="hljs-string">"*token"</span>, Agg.count()));
  }
}</code></pre>
<div class="source-toolbox"><span class="source-lang">java</span><button class="copy-button" title="Copy to clipboard"><img src="../../_/img/octicons-16.svg#view-clippy" alt="copy icon" class="copy-icon"><span class="copy-toast">Copied!</span></button></div></div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This changes the depotâ€™s partitioner from <code>Depot.random()</code>, which produces a
random hash value, to <code>Depot.hashBy(Ops.IDENTITY)</code>, which produces a hash
based on the appended recordâ€™s value.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We can remove the call to <code>.hashPartition("*token")</code> because
the words are already being sent to the right partition deterministically.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This is just a very small example of how your partitioning scheme has a direct
impact on your applicationâ€™s performance. As you work with Rama, youâ€™ll get a
better feel for designing with <em>where</em> in mind.</p>
</div>
<div class="paragraph">
<p>This design consideration becomes even more important in realistic applications,
where you have to decide where to store multiple related pieces of information.
The more you can store related information on the same partition, the less time
it will take to retrieve it all â€“ you wonâ€™t have to jump around to separate
tasks, possibly incurring extra network hops, to collect or update the
information you need.</p>
</div>
</div>
<div class="sect2">
<h3 id="_consistency"><a class="anchor" href="#_consistency"></a>Consistency</h3>
<div class="paragraph">
<p>A less obvious implication of Ramaâ€™s distributed design is that the <em>where</em>
element has implications for your dataâ€™s consistency. Consider the following
scenario:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You have a module that includes user profiles.</p>
</li>
<li>
<p>User profile edits are appended to a depot.</p>
</li>
<li>
<p>That depot has a random partitioner.</p>
</li>
<li>
<p>An ETL reads these edits and partitions on username.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now consider this timeline for the user <code>bananaman</code>. Assume that the ETL
processing profile edits partitions the username <code>bananaman</code> to task 1.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>bananaman</code> submits an edit and it arrives at <code>depot-0</code>, the depot partition
on task 0</p>
</li>
<li>
<p><code>bananaman</code> submits an edit and it arrives at <code>depot-1</code>, the depot partition
on task 1</p>
</li>
<li>
<p><code>etl-0</code>, the ETL starting on task 0, reads the edit from <code>depot-0</code>.</p>
</li>
<li>
<p><code>etl-1</code>, the ETL starting on task 1, reads the edit from <code>depot-1</code>.</p>
</li>
<li>
<p><code>etl-0</code> partitions to task 1.</p>
</li>
<li>
<p><code>etl-1</code> processes its edit and stores it in a PState.</p>
</li>
<li>
<p><code>etl-0</code> arrives on task 1.</p>
</li>
<li>
<p><code>etl-0</code> processes its edit and stores it in a PState, incorrectly replacing
the data from the second edit with the data from the (stale) first edit.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Rama has no guarantees about the global order in which depot records are
processed, so this hypothetical module design introduced the possibility for
race conditions.</p>
</div>
<div class="paragraph">
<p>The way to solve this is to introduce a depot partitioner. Rama <em>does</em> guarantee
that all <em>local</em> depot partition records are processed in the order in which
theyâ€™re received (indeed, messages sent between <em>any</em> two points are processed
in the order that theyâ€™re received). This would guarantee that the second edit
would be processed after the first, and that the fresh data would always
overwrite the stale data.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Distributed programming</em> is the practice of coordinating work and resources so
that work can be performed by <em>distributed systems</em>â€‰â€”â€‰networked machines which
communicate by message passing. Some systems are naturally distributed by their
architecture or separation of concerns; client/server systems, for example.
For other systems, we employ a distributed architecture for better performance
and resiliency.</p>
</div>
<div class="paragraph">
<p>Rama is distributed to provide better performance and enable resiliency. In this
chapter, we focused on the performance aspect: Rama systems improve performance
by spreading work across multiple nodes.</p>
</div>
<div class="paragraph">
<p>The underlying design abstraction that enables this is the task model. Tasks are
similar to processes in that theyâ€™re the runtime manifestation of module. ETL
execution takes place within a task, and tasks expose storage resources (depots
and PStates).</p>
</div>
<div class="paragraph">
<p>Depots and PStates are partitioned across tasks, meaning that each such
<em>logical</em> entity is split into separate <em>physical</em> storage locations, one per
task. When you refer to a PState or depot (for example, the PState
<code>$$wordCount</code>) from within an ETL, you are referring to that entityâ€™s partition
for the current task.</p>
</div>
<div class="paragraph">
<p>Within an ETL you can <em>partition</em> in the verb sense, meaning that the current
execution of the ETL gets relocated to a different task. When you relocate an
ETL, its scope travels with it. Anything youâ€™ve bound with <code>.out()</code> will
continue to be available, while PState and depot references will point to the
current partitions.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
</footer>
<script type="text/javascript" src="../../_/js/main.js"></script>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async="" src="../../_/js/vendor/highlight.js"></script>
  

<table cellspacing="0" cellpadding="0" role="presentation" class="gstl_50 gssb_c" style="width: 217px; display: none; top: 50px; left: 1048px; position: absolute;"><tbody><tr><td class="gssb_f"></td><td class="gssb_e" style="width: 100%;"></td></tr></tbody></table></body></html>